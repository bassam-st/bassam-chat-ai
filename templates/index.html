<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Chat-Like</title>
  <meta name="theme-color" content="#7c3aed"/>
  <link rel="manifest" href="/static/pwa/manifest.json"/>
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png"/>
  <style>
    :root{--bg:#0b0f19;--card:#121826;--pri:#7c3aed;--muted:#98a2b3}
    *{box-sizing:border-box}body{margin:0;background:var(--bg);color:#e5e7eb;font-family:system-ui,Segoe UI,Roboto,"Noto Naskh Arabic UI"}
    .wrap{max-width:900px;margin:0 auto;padding:14px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:12px;margin:12px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    input{flex:1;min-width:220px;padding:12px;border:none;border-radius:12px;background:#0f1421;color:#fff}
    button{padding:12px 16px;border:none;border-radius:12px;background:var(--pri);color:#fff;font-weight:700;cursor:pointer}
    .msg{white-space:pre-wrap;line-height:1.7;margin:8px 0;padding:10px;border-radius:10px}
    .user{background:#0f1421}.bot{background:#0f1220;border:1px solid #2a2f45}
    .ts{opacity:.75;font-size:12px;display:block;margin-bottom:6px}
    .notice{color:var(--muted);font-size:14px}
    .install{position:fixed;right:12px;bottom:12px;background:#7c3aed;color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:700}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Chat-Like <small class="notice">Ø§Ù„ÙˆØ¶Ø¹: {{ mode }} â€¢ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: {{ model }}</small></h2>
  <div id="chat" class="card"></div>
  <form class="card row" onsubmit="return sendMsg()">
    <input id="q" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©..." required/>
    <button type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
  </form>
  <div class="notice">ðŸ’¡ Ø¥Ø°Ø§ Ù„Ù… ØªØ±ÙŽ Ø±Ø¯Ø§Ù‹ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ù…ØªØºÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø© <code>OPENAI_API_KEY</code> (Ù„Ùˆ Ø£Ø±Ø¯Øª ÙˆØ¶Ø¹ OpenAI) ÙˆØ¥Ù„Ø§ Ø³ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ.</div>
</div>
<script src="/static/app.js"></script>
<script>
  // Ø²Ø± ØªØ«Ø¨ÙŠØª PWA
  let dp=null;
  window.addEventListener("beforeinstallprompt",(e)=>{e.preventDefault();dp=e;
    const b=document.createElement("button");b.className="install";b.textContent="ðŸ“± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚";
    b.onclick=async()=>{b.style.display="none";dp.prompt();await dp.userChoice;dp=null;};
    document.body.appendChild(b);
  });
  if("serviceWorker" in navigator){navigator.serviceWorker.register("/sw.js").catch(()=>{});}
</script>
</body>
</html>  chat.appendChild(holder);

  es.onmessage=(e)=>{
    const d=JSON.parse(e.data);
    if(d.chunk){ buf+=d.chunk; holder.childNodes[1].nodeValue="\n"+buf; chat.scrollTop=chat.scrollHeight; }
    if(d.done){ es.close(); }
  };
  es.onerror=()=>{ es.close(); };
  return false;
}
</script>
</body>
</html>
